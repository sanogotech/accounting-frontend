<div flex layout="column" layout-align="center" layout-fill>
  <!-- Filters Toolbar-->
  <ng-include src="'app/purchase-table/filters-toolbar.template.html'"></ng-include>

  <!-- Actual table -->
  <md-card layout="column" flex layout-align "center center">
    <!-- Pagination options and table title -->
    <md-toolbar class="md-table-toolbar" md-colors="{background: 'grey-50'}">
      <div class="md-toolbar-tools">
        <div>Purchases</div>
        <span flex></span>
        <div class="table-filters">
          <md-input-container>
            <label>Purchase Concept</label>
            <input ng-model="vm.params.item" ng-change="vm.search()">
          </md-input-container>
          <md-input-container>
            <label>Purchase Code</label>
            <input ng-model="vm.params.code" ng-change="vm.search()">
          </md-input-container>
        </div>
        <md-button class="md-raised md-primary" ng-click="vm.toggleFilters()">More Filters</md-button>
        <md-button class="md-raised md-primary" ng-href="#!/purchaseform">Add Purchase</md-button>
      </div>

      <div class="table-pagination" md-colors="{background: 'primary-800'}">
        <div layout-wrap flex="45">Applied filters:
          <div ng-repeat="item in vm.appliedFilters()">
            <md-button class="md-raised md-accent" ng-click="vm.chipRemoveFilter(item)" id="chip-remove">
              {{item}}
              <!-- <icon svg-icon="#close"></icon> -->
              <md-icon md-svg-src="assets/icons/close.svg"></md-icon>
            </md-button>
          </div>
        </div>
        <span flex></span>
        <div>Page:
          <md-select ng-model="vm.params.page" ng-change="vm.search()" aria-label="selPage">
            <md-option ng-repeat="n in [].constructor(vm.purchases.$metadata.totalPages) track by $index" ng-value="{{$index}}">{{$index+1}}</md-option>
          </md-select> of {{vm.purchases.$metadata.totalPages}}
        </div>
        <div>Rows per page:
          <md-select ng-model="vm.params.size" ng-change="vm.search()" aria-label="selSize">
            <md-option ng-repeat="size in vm.sizeOpt" ng-value="{{size}}">{{size}}</md-option>
          </md-select>
        </div>
        <div>Viewing {{vm.purchases.$metadata.page*vm.purchases.$metadata.size+1}} - {{(vm.purchases.$metadata.page+1)*vm.purchases.$metadata.size}}
          of {{vm.purchases.$metadata.totalElements}} purchases
        </div>
        <div>
          <md-button class="md-icon-button" ng-click="vm.prevPage()" ng-disabled="vm.purchases.$metadata.page==0" aria-label="prevPage">
            <md-tooltip md-direction="bottom">Previous page</md-tooltip>
            <md-icon icon svg-icon="#navPrev"></md-icon>
          </md-button>
          <md-button class="md-icon-button" ng-click="vm.nextPage()" ng-disabled="vm.purchases.$metadata.last" aria-label="nextPage">
            <md-tooltip md-direction="bottom">Next page</md-tooltip>
            <md-icon icon svg-icon="#navNext"></md-icon>
          </md-button>
        </div>
      </div>
    </md-toolbar>


    <!-- Table -->
    <md-table-container>
      <table md-table ng-table="vm.purchases" flex layout-fill>
        <thead md-head md-colors="{background: 'primary'}">
          <tr md-row>
            <!-- <th md-column class="md-thead">ID</th> -->
            <th md-column class="md-thead">Expense Date</th>
            <th md-column class="md-thead">Expense type</th>
            <th md-column class="md-thead">Concept</th>
            <th md-column class="md-thead">Cost</th>
            <th md-column class="md-thead">Supplier</th>
            <th md-column class="md-thead">Charging Project</th>
            <th md-column class="md-thead">Requesting Project</th>
            <th md-column class="md-thead">Code RP</th>
            <th md-column class="md-thead">Code LV</th>
            <th md-column class="md-thead">Code</th>
            <!-- <th md-column class="md-thead">Comments</th> -->
            <th md-column class="md-thead">Status</th>
            <th md-column class="md-thead">Invoice</th>
            <th md-column class="md-thead"></th>
          </tr>
        </thead>
        <tbody md-body>
          <tr md-row ng-repeat="purchase in vm.purchases">
            <!-- <td md-cell>{{purchase.id}}</td> -->
            <td md-cell>{{purchase.requestDate | date: "dd/MM/yyyy"}}</td>
            <td md-cell>{{purchase.type.name}}</td>
            <td md-cell>{{purchase.item}}</td>
            <td md-cell>{{purchase.amount | currency : " "}}â‚¬</td>
            <td md-cell>{{purchase.supplier.name}}</td>
            <td md-cell>{{purchase.chargingProject.code}} - {{purchase.chargingProject.name}}</td>
            <td md-cell>{{purchase.chargingProject.code}} - {{purchase.requestingProject.name}}</td>
            <td md-cell>{{purchase.codeRP}}</td>
            <td md-cell>{{purchase.codeLV}}</td>
            <td md-cell>{{purchase.code}}</td>
            <!-- <td md-cell>{{purchase.comments}}</td> -->
            <td md-cell>
              <span class="badge" md-colors="{background: vm.badgeColor('{{purchase.state.color}}')}">{{purchase.state.name}}</span>
            </td>
            <td md-cell>
              <md-button class="md-icon-button" ng-click="vm.downloadInvoice(purchase)" ng-disabled="vm.availableInvoice(purchase)" aria-label="downloadInvoice">
                <md-tooltip md-direction="bottom">Download Invoice</md-tooltip>
                <md-icon class="table-icon" icon svg-icon="#attach"></md-icon>
              </md-button>
            </td>
            <td md-cell>
              <md-button class="md-icon-button" ng-click="vm.editItem(purchase)">
                <md-tooltip md-direction="bottom">Edit Purchase</md-tooltip>
                <md-icon class="table-icon" icon svg-icon="#edit"></md-icon>
              </md-button>
            </td>
          </tr>
        </tbody>
      </table>
    </md-table-container>
  </md-card>
</div>